# Step 7: Publishing System

## Overview
Create the publishing workflow that converts drafts to permanent, immutable posts with unique URLs.

## Requirements
- Build publishing interface with title and slug input
- Generate unique URLs for published posts (signify.app/posts/abc123)
- Make published content immutable (no editing allowed)
- Create database entries linking posts to keystroke data
- Add post metadata (published_at, word_count, character_count)
- Implement URL slug generation and validation
- Handle publishing errors and edge cases
- Add publishing confirmation dialog

## Technical Specifications
- Generate URL-safe random slugs (8 characters, alphanumeric)
- Check slug uniqueness before publishing
- POST /posts/publish endpoint with validation
- Set published_at timestamp on server
- Calculate accurate word and character counts
- Prevent duplicate publishing of same draft
- Include basic SEO metadata in posts

## Implementation Prompt

```
Implement the publishing system that converts drafts to permanent, immutable posts with unique URLs.

Requirements:
1. Publishing interface:
   - Title input with validation (required, 1-200 chars)
   - Optional custom slug input with validation
   - Content preview before publishing
   - Publishing confirmation dialog
   - Success page with shareable link
   - Error handling for failed publishes

2. Backend publishing endpoint:
   - POST /posts/publish
   - Accept: { draftId, title, customSlug? }
   - Generate unique slug if not provided
   - Move draft data to published post
   - Create immutable post record
   - Return: { postId, slug, publishedAt, url }

3. URL slug generation:
   - Generate 8-character alphanumeric slugs (e.g., "a7B9x2mK")
   - Check uniqueness against existing posts
   - Allow custom slugs with validation
   - URL-safe characters only: [a-zA-Z0-9-]
   - Handle slug conflicts gracefully

4. Database operations:
   - Insert into posts table with proper relationships
   - Transfer keystroke data from draft to post
   - Calculate and store metadata (word_count, char_count)
   - Set published_at timestamp
   - Delete draft after successful publish

5. Immutability enforcement:
   - No edit endpoints for published posts
   - Clear UI indication that posts are final
   - Warning before publishing about immutability
   - Database constraints preventing updates
   - Audit trail for any access attempts

6. Content validation:
   - Minimum content length (50 words)
   - Maximum content length (50,000 words)
   - Valid HTML structure
   - No malicious content detection
   - Keystroke data integrity validation

7. Publishing UI components:
   - PublishDialog component with form
   - Title and slug input components
   - Content preview component
   - Publishing progress indicator
   - Success/error message handling
   - Shareable link display

8. Error handling:
   - Network failures during publish
   - Validation errors (title, content, slug)
   - Duplicate slug conflicts
   - Database transaction failures
   - Large content handling

9. Success flow:
   - Immediate redirect to published post
   - Share buttons for social media
   - Copy link functionality
   - Analytics tracking for publishes
   - Clear next action guidance

10. SEO and metadata:
    - Generate meta description from content
    - Set proper page titles
    - Add OpenGraph metadata
    - Include structured data markup
    - Optimize for search engines

Create a reliable publishing system that ensures posts are permanently archived with their keystroke data while providing excellent user experience.
```

## Deliverables
- Publishing UI with title/slug inputs
- POST /posts/publish API endpoint
- Unique URL generation system
- Immutable post creation
- Publishing confirmation flow
- Proper error handling and validation
- Database relationships between posts and keystrokes